# 予定調整くん

## 概要

予定調整くんはスケジュール調整サービスで、

* できるだけ多くの人が参加できる適切な予定日時を決定したい

という目的のために作られたサービスです。

社内サービス的なものをイメージしてます。

## 要件

予定調整くんの要件は、
* 予定を作れる
* 予定の候補を作れる
* 予定の候補に対して出欠を編集できる
* 予定に対してコメントを編集できる
* 予定を削除できる
* 予定を編集できる

以上です。

## 用語
以下の表は、この予定調整くんにおける用語一覧です。

| 用語 | 英語表記 | 意味 |
| :--- | :--- | :--- |
| ユーザ | user |	予定調整くんの利用者 |
| 予定 | schedule | 複数のユーザの出欠が必要なイベント |
| 候補 | candidate | 予定の開催の日時および期間の候補 |
| 出欠 | availability | 予定の候補に対する出欠意思<br>欠席・わからない・出席 が選べる | 
| コメント | comment | 予定に対してユーザがつけるコメント |

この予定調整くんにおいては、
「ユーザー」ではなく「ユーザ」を使います。

## データモデリング

図を書くのは無理なので諦めた。

### エンティティ: ユーザ
ユーザは、予定、出欠、コメントとそれぞれ
「1 対 多」の関連を持っている。

* ユーザは予定を作成できる
* ユーザは予定の候補に対して出欠を編集できる
* ユーザは予定に対してコメントを編集できる

予定、出欠、コメントはそれぞれ、ユーザに従属している。

###　 エンティティ: 予定
予定は、候補とコメントとそれぞれ 
「1 対 多」の関連を持っている。

* 予定に対して候補を作れる
* 予定に対してコメントを編集できる

候補とコメントは予定に従属している。

###　 エンティティ: 候補
候補は、出欠と「1 対 多」の関連を持っている。

* 予定の候補に対して出欠を編集できる

出欠は候補に従属している。

### エンティティ: コメント
コメントは、ユーザと「多 対 1」である。

* 予定に対してコメントを編集できる

コメントはユーザに従属している。

## URL設計

予定調整くんのURL設計についてです。

### ページ構成

以下は予定調整くんのページ一覧です。

* トップ / 自分が作った予定の一覧ページ
    * ログイン時: 作成した予定一覧
    * ログアウト時: 紹介ページ...になるかも
* 予定表示 / 出欠 / コメントページ
* 予定作成ページ
* 予定編集ページ
* <s>紹介ページ（オリジナル）</s>

### URL 一覧

以下はパスと内容をまとめた表です。

##### Method: GET （ページのURL）
| パス | ページ名 | ページ内容 |
| :--- | :--- | :--- |
| / | トップページ | 自分の作った予定一覧を表示 |
| /schedules/new | 予定作成ページ | 新しい予定を作成 |
| /schedules/:scheduleId | 予定表示ページ | 予定の内容、出欠表、コメントを表示 |
| /schedules/:scheduleId/edit | 予定編集ページ | 予定の編集や削除をする |
| /login | ログイン | ログインする |
| /logout | ログアウト | ログアウトする |

##### Method: POST （Web API）
| パス | 処理内容 | 利用方法 |
| :--- | :--- | :--- |
| /schedules | 予定作成 | フォーム |
| /schedules/:scheduleId/update | 予定編集 | フォーム |
| /schedules/:scheduleId/delete	| 予定削除 | フォーム |
| /schedules/:scheduleId/candidates/:candidateId | 出欠編集 |	AJAX |
| /schedules/:scheduleId/comments	| コメント編集 | AJAX|

##### パラメータ一覧
| パラメータ | 中身 |
| :--- | :--- |
|`:scheduleId` | 予定エンティティの主キー |
|`:userId` | ユーザエンティティの主キー |
|`:candidateId` | 候補エンティティの主キー |


## モジュール設計

### 使用するサービス

予定調整くんには、以下を使用します。
* フレームワーク: Express
* データベースを操作するライブラリ: prisma
* データベース: postgreSQL
* テンプレート: Pug
* helmet

### Router モジュール一覧

| ファイル名 | 責務 |
| :--- | :--- |
| routes/login.js | ログイン処理 |
| routes/logout.js | ログアウト処理 |
| routes/schedules.js | 予定に関連する処理 |
| routes/availabilities.js | 出欠の更新に関する処理 |
| routes/comments.js | コメントの更新に関する処理 |

### データモデル一覧
| テーブル名 | 内容 |
| :--- | :--- | 
User |ユーザのデータモデル
Schedule | 予定のデータモデル
Candidate | 候補のデータモデル
Availability | 出欠のデータモデル
Comment | コメントのデータモデル


## 実装の流れ

<!-- INFO 実装の流れ -->

* <del>サービスの設計(第 1 回)</del>
* <del>機能の実装</del>
    * <del>プロジェクトの作成と認証の実装(第 2 回)</del>
    * <del>データモデルの実装とユーザの保存(第 3 回)</del>
    * <del>予定の作成と表示(第 4 回)</del>
    * <del>出欠の表示と更新(第 5 回)</del>
    * <del>コメントの表示・更新(第 6 回)</del>
    * <del>予定の編集と削除(第 7 回)</del>
* <del>デザインの改善(第 8 回)</del>
* セキュリティ対策と公開(第 9 回)


## スタートアップ

開発を始める前に、
以下のコマンドを入力してください。

```
yarn install
echo 'DATABASE_URL="postgresql://postgres:postgres@db/schedule_arranger"' > .env
npx prisma db push
npx prisma generate
```